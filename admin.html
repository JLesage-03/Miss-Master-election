// ===== ADMIN DASHBOARD SCRIPT =====

let db;
let currentFilter = 'all';
let adminSession = null;
let countdownInterval = null;

// Initialize admin dashboard
document.addEventListener('DOMContentLoaded', () => {
    // Load the database from main script
    if (typeof Database === 'function') {
        db = new Database();
    } else {
        // Fallback if Database class not loaded
        console.error('Database class not found. Make sure script.js is loaded first.');
        db = {
            candidates: [],
            votes: [],
            voters: [],
            settings: {
                electionTitle: 'NFONAP Miss & Master Elections 2025',
                votingDeadline: '2025-12-13T13:00:00',
                allowVoting: true
            },
            loadData: function() {
                // Load from localStorage
                this.candidates = JSON.parse(localStorage.getItem('nfonap_candidates_v2') || '[]');
                this.votes = JSON.parse(localStorage.getItem('nfonap_votes_v2') || '[]');
                this.voters = JSON.parse(localStorage.getItem('nfonap_voters_v2') || '[]');
                this.settings = JSON.parse(localStorage.getItem('nfonap_settings_v2') || JSON.stringify(this.settings));
            },
            saveData: function() {
                localStorage.setItem('nfonap_candidates_v2', JSON.stringify(this.candidates));
                localStorage.setItem('nfonap_votes_v2', JSON.stringify(this.votes));
                localStorage.setItem('nfonap_voters_v2', JSON.stringify(this.voters));
                localStorage.setItem('nfonap_settings_v2', JSON.stringify(this.settings));
            },
            getCandidates: function(category = null) {
                if (category) {
                    return this.candidates.filter(c => c.category === category && (!c.status || c.status === 'active'));
                }
                return this.candidates.filter(c => !c.status || c.status === 'active');
            },
            getCandidateById: function(id) {
                return this.candidates.find(c => c.id === id);
            }
        };
        db.loadData();
    }
    
    // Check for existing data or initialize
    if (db.candidates.length === 0) {
        initializeDefaultData();
    }
    
    checkAdminSession();
    initializeEventListeners();
    updateAdminCountdown(); // Start countdown
});

// Initialize default data for demo
function initializeDefaultData() {
    const defaultCandidates = [
        {
            id: 'candidate-1',
            category: 'miss',
            name: 'Amara Ndeze',
            program: 'Computer Science',
            department: 'Faculty of Engineering',
            email: 'amara.ndeze@nfonap.edu.cm',
            bio: 'Passionate about technology and community development. Active in student organizations.',
            manifesto: 'Dedicated to improving campus technology infrastructure and fostering innovation.',
            createdAt: new Date().toISOString()
        },
        {
            id: 'candidate-2',
            category: 'miss',
            name: 'Christelle Tanyi',
            program: 'Business Administration',
            department: 'Faculty of Business',
            email: 'christelle.tanyi@nfonap.edu.cm',
            bio: 'Entrepreneur and business enthusiast with a focus on sustainable development.',
            manifesto: 'Committed to promoting entrepreneurship and supporting student businesses.',
            createdAt: new Date().toISOString()
        },
        {
            id: 'candidate-3',
            category: 'master',
            name: 'David Ngufor',
            program: 'Software Engineering',
            department: 'Faculty of Engineering',
            email: 'david.ngufor@nfonap.edu.cm',
            bio: 'Tech leader with experience in software development and project management.',
            manifesto: 'Working towards digital transformation and excellence in academic excellence.',
            createdAt: new Date().toISOString()
        },
        {
            id: 'candidate-4',
            category: 'master',
            name: 'Benjamin Nkwa',
            program: 'Finance',
            department: 'Faculty of Business',
            email: 'benjamin.nkwa@nfonap.edu.cm',
            bio: 'Economics scholar focused on development and financial inclusion.',
            manifesto: 'Advocating for economic growth and student welfare improvement.',
            createdAt: new Date().toISOString()
        }
    ];

    db.candidates = defaultCandidates;
    db.saveData();
    
    // Also save default settings
    const CONFIG = {
        ADMIN_CREDENTIALS: {
            username: 'admin',
            password: 'nfonap2025'
        },
        VOTING_DEADLINE: new Date('December 13, 2025 13:00:00')
    };
    
    // Store default admin password if not exists
    if (!localStorage.getItem('adminPassword')) {
        localStorage.setItem('adminPassword', CONFIG.ADMIN_CREDENTIALS.password);
    }
}

// Check if admin is logged in
function checkAdminSession() {
    const session = sessionStorage.getItem('adminSession');
    if (session) {
        adminSession = JSON.parse(session);
        showDashboard();
    } else {
        showLoginForm();
    }
}

// Initialize event listeners
function initializeEventListeners() {
    // Modal close buttons
    document.querySelectorAll('.modal-close').forEach(btn => {
        btn.addEventListener('click', (e) => {
            const modal = e.target.closest('.modal-overlay');
            modal.style.display = 'none';
        });
    });

    // Click outside modal to close
    document.querySelectorAll('.modal-overlay').forEach(modal => {
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                modal.style.display = 'none';
            }
        });
    });

    // Mobile menu
    const mobileMenuBtn = document.querySelector('.mobile-menu-btn');
    if (mobileMenuBtn) {
        mobileMenuBtn.addEventListener('click', toggleMobileMenu);
    }
    
    // Allow Enter key to submit login
    document.getElementById('admin-password')?.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            login();
        }
    });
}

// ===== LOGIN FUNCTIONS =====
function login() {
    const username = document.getElementById('admin-username').value.trim();
    const password = document.getElementById('admin-password').value.trim();

    if (!username || !password) {
        Toast.show('Please enter username and password', 'warning');
        return;
    }

    // Get stored password or use default
    let storedPassword = localStorage.getItem('adminPassword');
    if (!storedPassword) {
        storedPassword = 'nfonap2025'; // Default password
        localStorage.setItem('adminPassword', storedPassword);
    }
    
    // Check credentials
    if (username === 'admin' && password === storedPassword) {
        adminSession = {
            username: username,
            loginTime: new Date().toISOString(),
            lastActivity: new Date().toISOString()
        };
        sessionStorage.setItem('adminSession', JSON.stringify(adminSession));
        
        // Clear form
        document.getElementById('admin-username').value = '';
        document.getElementById('admin-password').value = '';
        
        showDashboard();
        Toast.show('Login successful!', 'success');
    } else {
        Toast.show('Invalid username or password', 'error');
    }
}

function logout() {
    if (confirm('Are you sure you want to logout?')) {
        sessionStorage.removeItem('adminSession');
        adminSession = null;
        showLoginForm();
        Toast.show('Logged out successfully', 'info');
    }
}

function showLoginForm() {
    document.getElementById('login-section').style.display = 'block';
    document.getElementById('dashboard-section').style.display = 'none';
    document.getElementById('logout-btn').style.display = 'none';
}

function showDashboard() {
    document.getElementById('login-section').style.display = 'none';
    document.getElementById('dashboard-section').style.display = 'block';
    document.getElementById('logout-btn').style.display = 'inline-block';
    
    // Update welcome info
    document.getElementById('admin-name').textContent = adminSession.username;
    updateLastLoginTime();
    
    // Display deadline
    const deadline = new Date(db.settings.votingDeadline || '2025-12-13T13:00:00');
    document.getElementById('deadline-display').textContent = deadline.toLocaleString();
    
    // Load dashboard data
    refreshDashboard();
    
    // Start countdown timer
    if (countdownInterval) clearInterval(countdownInterval);
    countdownInterval = setInterval(updateAdminCountdown, 1000);
}

function updateLastLoginTime() {
    const loginTime = new Date(adminSession.loginTime);
    document.getElementById('last-login').textContent = loginTime.toLocaleString();
}

// ===== COUNTDOWN FUNCTIONS =====
function updateAdminCountdown() {
    const now = new Date();
    const deadline = new Date(db.settings.votingDeadline || '2025-12-13T13:00:00');
    const diff = deadline - now;
    
    if (diff <= 0) {
        document.getElementById('admin-countdown-days').textContent = '00';
        document.getElementById('admin-countdown-hours').textContent = '00';
        document.getElementById('admin-countdown-minutes').textContent = '00';
        document.getElementById('admin-countdown-seconds').textContent = '00';
        return;
    }
    
    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
    const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
    const seconds = Math.floor((diff % (1000 * 60)) / 1000);
    
    document.getElementById('admin-countdown-days').textContent = days.toString().padStart(2, '0');
    document.getElementById('admin-countdown-hours').textContent = hours.toString().padStart(2, '0');
    document.getElementById('admin-countdown-minutes').textContent = minutes.toString().padStart(2, '0');
    document.getElementById('admin-countdown-seconds').textContent = seconds.toString().padStart(2, '0');
}

// ===== DASHBOARD FUNCTIONS =====
function refreshDashboard() {
    db.loadData();
    updateStatistics();
    loadCandidatesTable();
    updateVotingStatus();
}

function updateStatistics() {
    const totalCandidates = db.candidates.length;
    const missCandidates = db.candidates.filter(c => c.category === 'miss').length;
    const masterCandidates = db.candidates.filter(c => c.category === 'master').length;
    const totalVotes = db.votes.length;
    const totalVoters = db.voters.length;

    document.getElementById('admin-total-candidates').textContent = totalCandidates;
    document.getElementById('admin-total-votes').textContent = totalVotes;
    document.getElementById('admin-miss-candidates').textContent = missCandidates;
    document.getElementById('admin-master-candidates').textContent = masterCandidates;
    document.getElementById('admin-total-voters').textContent = totalVoters;
}

function loadCandidatesTable() {
    const container = document.getElementById('candidates-table');
    let candidates = db.candidates;

    // Filter candidates
    if (currentFilter === 'miss') {
        candidates = candidates.filter(c => c.category === 'miss');
    } else if (currentFilter === 'master') {
        candidates = candidates.filter(c => c.category === 'master');
    }

    if (candidates.length === 0) {
        container.innerHTML = '<p class="text-center text-muted" style="padding: 2rem;">No candidates found</p>';
        return;
    }

    let html = '<table class="table" style="width: 100%; border-collapse: collapse;">';
    html += '<thead><tr style="background: #f5f5f5; border-bottom: 2px solid #ddd;">';
    html += '<th style="padding: 1rem; text-align: left;">Name</th>';
    html += '<th style="padding: 1rem; text-align: left;">Category</th>';
    html += '<th style="padding: 1rem; text-align: left;">Program</th>';
    html += '<th style="padding: 1rem; text-align: left;">Votes</th>';
    html += '<th style="padding: 1rem; text-align: center;">Actions</th>';
    html += '</tr></thead><tbody>';

    candidates.forEach(candidate => {
        const voteCount = db.votes.filter(v => v.candidateId === candidate.id).length;
        const categoryLabel = candidate.category === 'miss' ? 'ðŸ‘© Miss' : 'ðŸ‘¨ Master';
        
        html += `<tr style="border-bottom: 1px solid #eee;">
            <td style="padding: 1rem;"><strong>${candidate.name}</strong></td>
            <td style="padding: 1rem;">${categoryLabel}</td>
            <td style="padding: 1rem;">${candidate.program}</td>
            <td style="padding: 1rem;"><strong>${voteCount}</strong></td>
            <td style="padding: 1rem; text-align: center;">
                <button class="btn btn-sm btn-info" onclick="editCandidate('${candidate.id}')">
                    <i class="fas fa-edit"></i> Edit
                </button>
                <button class="btn btn-sm btn-danger" onclick="deleteCandidate('${candidate.id}')">
                    <i class="fas fa-trash"></i> Delete
                </button>
            </td>
        </tr>`;
    });

    html += '</tbody></table>';
    container.innerHTML = html;
    
    // Update filter buttons
    updateFilterButtons();
}

function updateFilterButtons() {
    const buttons = document.querySelectorAll('#filter-buttons button');
    buttons.forEach(btn => {
        btn.classList.remove('btn-primary');
        btn.classList.add('btn-outline');
    });
    
    const activeBtn = Array.from(buttons).find(btn => 
        btn.textContent.toLowerCase().includes(currentFilter)
    );
    if (activeBtn) {
        activeBtn.classList.remove('btn-outline');
        activeBtn.classList.add('btn-primary');
    }
}

function filterCandidates(filter) {
    currentFilter = filter;
    loadCandidatesTable();
}

// ===== CANDIDATE MANAGEMENT =====
function showAddCandidateModal() {
    document.getElementById('add-candidate-modal').style.display = 'flex';
    document.getElementById('add-candidate-form').reset();
}

function closeAddCandidateModal() {
    document.getElementById('add-candidate-modal').style.display = 'none';
}

function addCandidate() {
    const category = document.getElementById('candidate-category').value;
    const name = document.getElementById('candidate-name').value.trim();
    const program = document.getElementById('candidate-program').value.trim();
    const department = document.getElementById('candidate-department').value.trim();
    const email = document.getElementById('candidate-email').value.trim();
    const bio = document.getElementById('candidate-bio').value.trim();
    const manifesto = document.getElementById('candidate-manifesto').value.trim();
    const photo = document.getElementById('candidate-photo').value.trim();

    // Validation
    if (!category || !name || !program || !department || !bio) {
        Toast.show('Please fill in all required fields', 'warning');
        return;
    }

    // Create candidate object
    const candidate = {
        id: 'candidate-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9),
        category,
        name,
        program,
        department,
        email,
        bio,
        manifesto,
        photo: photo || 'assets/default-avatar.jpg',
        createdAt: new Date().toISOString(),
        status: 'active'
    };

    // Add to database
    db.candidates.push(candidate);
    db.saveData();

    // Clear form and close modal
    document.getElementById('add-candidate-form').reset();
    closeAddCandidateModal();

    // Refresh dashboard
    refreshDashboard();
    Toast.show('Candidate added successfully!', 'success');
}

function editCandidate(candidateId) {
    const candidate = db.candidates.find(c => c.id === candidateId);
    if (!candidate) {
        Toast.show('Candidate not found', 'error');
        return;
    }

    // Fill form with candidate data
    document.getElementById('edit-candidate-id').value = candidate.id;
    document.getElementById('edit-candidate-category').value = candidate.category;
    document.getElementById('edit-candidate-name').value = candidate.name;
    document.getElementById('edit-candidate-program').value = candidate.program;
    document.getElementById('edit-candidate-department').value = candidate.department;
    document.getElementById('edit-candidate-email').value = candidate.email || '';
    document.getElementById('edit-candidate-bio').value = candidate.bio;
    document.getElementById('edit-candidate-manifesto').value = candidate.manifesto || '';
    document.getElementById('edit-candidate-photo').value = candidate.photo || '';

    // Show modal
    document.getElementById('edit-candidate-modal').style.display = 'flex';
}

function closeEditCandidateModal() {
    document.getElementById('edit-candidate-modal').style.display = 'none';
}

function updateCandidate() {
    const candidateId = document.getElementById('edit-candidate-id').value;
    const category = document.getElementById('edit-candidate-category').value;
    const name = document.getElementById('edit-candidate-name').value.trim();
    const program = document.getElementById('edit-candidate-program').value.trim();
    const department = document.getElementById('edit-candidate-department').value.trim();
    const email = document.getElementById('edit-candidate-email').value.trim();
    const bio = document.getElementById('edit-candidate-bio').value.trim();
    const manifesto = document.getElementById('edit-candidate-manifesto').value.trim();
    const photo = document.getElementById('edit-candidate-photo').value.trim();

    // Validation
    if (!category || !name || !program || !department || !bio) {
        Toast.show('Please fill in all required fields', 'warning');
        return;
    }

    // Find and update candidate
    const candidateIndex = db.candidates.findIndex(c => c.id === candidateId);
    if (candidateIndex === -1) {
        Toast.show('Candidate not found', 'error');
        return;
    }

    db.candidates[candidateIndex] = {
        ...db.candidates[candidateIndex],
        category,
        name,
        program,
        department,
        email,
        bio,
        manifesto,
        photo: photo || db.candidates[candidateIndex].photo,
        updatedAt: new Date().toISOString()
    };

    db.saveData();
    closeEditCandidateModal();
    refreshDashboard();
    Toast.show('Candidate updated successfully!', 'success');
}

function deleteCandidate(candidateId) {
    if (!confirm('Are you sure you want to delete this candidate? This action cannot be undone.')) {
        return;
    }

    // Find and remove candidate
    const index = db.candidates.findIndex(c => c.id === candidateId);
    if (index === -1) {
        Toast.show('Candidate not found', 'error');
        return;
    }

    // Also remove all votes for this candidate
    db.votes = db.votes.filter(v => v.candidateId !== candidateId);

    db.candidates.splice(index, 1);
    db.saveData();

    refreshDashboard();
    Toast.show('Candidate deleted successfully!', 'success');
}

// ===== DATABASE MANAGEMENT =====
function backupDatabase() {
    db.loadData();
    
    const backup = {
        timestamp: new Date().toISOString(),
        candidates: db.candidates,
        votes: db.votes,
        voters: db.voters,
        settings: db.settings
    };

    const dataStr = JSON.stringify(backup, null, 2);
    const dataBlob = new Blob([dataStr], { type: 'application/json' });
    const url = URL.createObjectURL(dataBlob);
    const link = document.createElement('a');
    link.href = url;
    link.download = `nfonap-elections-backup-${new Date().toISOString().slice(0, 10)}.json`;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    URL.revokeObjectURL(url);

    Toast.show('Database backed up successfully!', 'success');
}

function restoreDatabase() {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.json';
    input.onchange = (e) => {
        const file = e.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = (event) => {
            try {
                const backup = JSON.parse(event.target.result);
                
                // Validate backup structure
                if (!backup.candidates || !backup.votes || !backup.voters || !backup.settings) {
                    throw new Error('Invalid backup file format');
                }

                db.candidates = backup.candidates;
                db.votes = backup.votes;
                db.voters = backup.voters;
                db.settings = backup.settings;
                db.saveData();

                refreshDashboard();
                Toast.show('Database restored successfully!', 'success');
            } catch (error) {
                Toast.show('Error restoring database: ' + error.message, 'error');
            }
        };
        reader.readAsText(file);
    };
    input.click();
}

function resetDatabase() {
    const confirmed = confirm('âš ï¸ WARNING! This will permanently delete ALL data (candidates, votes, etc.). This action cannot be undone. Are you sure?');
    
    if (!confirmed) {
        Toast.show('Reset cancelled', 'info');
        return;
    }

    const finalConfirm = confirm('This is your LAST warning. Type "RESET" in the next prompt to confirm.');
    
    if (!finalConfirm) {
        Toast.show('Reset cancelled', 'info');
        return;
    }

    const userInput = prompt('Type "RESET" to confirm permanent data deletion:');
    
    if (userInput === 'RESET') {
        db.candidates = [];
        db.votes = [];
        db.voters = [];
        db.settings = {
            electionTitle: 'NFONAP Miss & Master Elections 2025',
            votingDeadline: '2025-12-13T13:00:00',
            allowVoting: true
        };
        db.saveData();

        refreshDashboard();
        Toast.show('Database has been reset!', 'success');
    } else {
        Toast.show('Reset cancelled', 'info');
    }
}

function clearAllVotes() {
    if (!confirm('Are you sure you want to clear all votes? This will reset vote counts to zero.')) {
        return;
    }
    
    db.votes = [];
    db.voters = [];
    db.saveData();
    
    refreshDashboard();
    Toast.show('All votes cleared successfully!', 'success');
}

// ===== EXPORT DATA =====
function exportData() {
    db.loadData();
    
    // Create CSV content
    let csv = 'Name,Category,Program,Department,Email,Votes\n';
    
    db.candidates.forEach(candidate => {
        const voteCount = db.votes.filter(v => v.candidateId === candidate.id).length;
        const row = [
            candidate.name,
            candidate.category,
            candidate.program,
            candidate.department,
            candidate.email || '',
            voteCount
        ].map(val => `"${val}"`).join(',');
        csv += row + '\n';
    });

    const dataBlob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
    const url = URL.createObjectURL(dataBlob);
    const link = document.createElement('a');
    link.href = url;
    link.download = `nfonap-elections-export-${new Date().toISOString().slice(0, 10)}.csv`;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    URL.revokeObjectURL(url);

    Toast.show('Data exported successfully!', 'success');
}

// ===== PASSWORD MANAGEMENT =====
function showPasswordModal() {
    document.getElementById('password-modal').style.display = 'flex';
    document.getElementById('current-password').value = '';
    document.getElementById('new-password').value = '';
    document.getElementById('confirm-password').value = '';
}

function closePasswordModal() {
    document.getElementById('password-modal').style.display = 'none';
}

function changePassword() {
    const currentPassword = document.getElementById('current-password').value;
    const newPassword = document.getElementById('new-password').value;
    const confirmPassword = document.getElementById('confirm-password').value;

    if (!currentPassword || !newPassword || !confirmPassword) {
        Toast.show('Please fill in all password fields', 'warning');
        return;
    }

    let storedPassword = localStorage.getItem('adminPassword');
    if (!storedPassword) {
        storedPassword = 'nfonap2025'; // Default
    }
    
    if (currentPassword !== storedPassword) {
        Toast.show('Current password is incorrect', 'error');
        return;
    }

    if (newPassword !== confirmPassword) {
        Toast.show('New passwords do not match', 'error');
        return;
    }

    if (newPassword.length < 6) {
        Toast.show('New password must be at least 6 characters', 'warning');
        return;
    }

    // Update password in localStorage
    localStorage.setItem('adminPassword', newPassword);

    // Clear form and close modal
    closePasswordModal();

    Toast.show('Password changed successfully!', 'success');
}

// ===== DEADLINE MANAGEMENT =====
function showDeadlineModal() {
    document.getElementById('deadline-modal').style.display = 'flex';
    const deadline = new Date(db.settings.votingDeadline || '2025-12-13T13:00:00');
    const localDateTime = deadline.toISOString().slice(0, 16);
    document.getElementById('new-deadline').value = localDateTime;
}

function closeDeadlineModal() {
    document.getElementById('deadline-modal').style.display = 'none';
}

function updateDeadline() {
    const newDeadline = document.getElementById('new-deadline').value;
    if (!newDeadline) {
        Toast.show('Please select a new deadline', 'warning');
        return;
    }

    const deadlineDate = new Date(newDeadline);
    if (isNaN(deadlineDate.getTime())) {
        Toast.show('Invalid date format', 'error');
        return;
    }

    db.settings.votingDeadline = deadlineDate.toISOString();
    db.saveData();
    
    closeDeadlineModal();
    updateAdminCountdown();
    document.getElementById('deadline-display').textContent = deadlineDate.toLocaleString();
    Toast.show('Voting deadline updated successfully!', 'success');
}

// ===== VOTING STATUS MANAGEMENT =====
function toggleVotingStatus() {
    db.settings.allowVoting = !db.settings.allowVoting;
    db.saveData();
    updateVotingStatus();
    
    const status = db.settings.allowVoting ? 'enabled' : 'disabled';
    Toast.show(`Voting has been ${status}`, 'success');
}

function updateVotingStatus() {
    const statusEl = document.getElementById('voting-status');
    const buttonEl = document.getElementById('toggle-voting-btn');
    
    if (db.settings.allowVoting) {
        statusEl.textContent = 'Active';
        statusEl.className = 'badge badge-success';
        buttonEl.innerHTML = '<i class="fas fa-pause"></i> Pause Voting';
    } else {
        statusEl.textContent = 'Paused';
        statusEl.className = 'badge badge-danger';
        buttonEl.innerHTML = '<i class="fas fa-play"></i> Resume Voting';
    }
}

// ===== UTILITY FUNCTIONS =====
function toggleMobileMenu() {
    const nav = document.querySelector('.nav');
    nav.classList.toggle('active');
}

// Toast notification system
class Toast {
    static show(message, type = 'info', duration = 5000) {
        const container = document.getElementById('toast-container') || this.createContainer();
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        toast.innerHTML = `
            <div class="toast-icon">
                ${this.getIcon(type)}
            </div>
            <div class="toast-message">${message}</div>
            <button class="toast-close">&times;</button>
        `;
        
        container.appendChild(toast);
        
        // Auto remove after duration
        setTimeout(() => this.remove(toast), duration);
        
        // Close button
        toast.querySelector('.toast-close').onclick = () => this.remove(toast);
    }
    
    static createContainer() {
        const container = document.createElement('div');
        container.id = 'toast-container';
        container.className = 'toast-container';
        document.body.appendChild(container);
        return container;
    }
    
    static getIcon(type) {
        const icons = {
            success: 'âœ“',
            error: 'âœ—',
            warning: 'âš ',
            info: 'â„¹'
        };
        return icons[type] || 'â„¹';
    }
    
    static remove(toast) {
        toast.style.animation = 'slideInRight 0.3s ease reverse forwards';
        setTimeout(() => {
            if (toast.parentElement) {
                toast.parentElement.removeChild(toast);
            }
        }, 300);
    }
}

// Make functions available globally
window.login = login;
window.logout = logout;
window.refreshDashboard = refreshDashboard;
window.exportData = exportData;
window.showAddCandidateModal = showAddCandidateModal;
window.closeAddCandidateModal = closeAddCandidateModal;
window.addCandidate = addCandidate;
window.editCandidate = editCandidate;
window.closeEditCandidateModal = closeEditCandidateModal;
window.updateCandidate = updateCandidate;
window.deleteCandidate = deleteCandidate;
window.filterCandidates = filterCandidates;
window.backupDatabase = backupDatabase;
window.restoreDatabase = restoreDatabase;
window.resetDatabase = resetDatabase;
window.showPasswordModal = showPasswordModal;
window.closePasswordModal = closePasswordModal;
window.changePassword = changePassword;
window.showDeadlineModal = showDeadlineModal;
window.updateDeadline = updateDeadline;
window.toggleVotingStatus = toggleVotingStatus;
window.clearAllVotes = clearAllVotes;
window.toggleMobileMenu = toggleMobileMenu;
