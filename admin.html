<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - NFONAP Elections 2025</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Montserrat:wght@700;800;900&display=swap" rel="stylesheet">
    <link rel="icon" type="image/x-icon" href="assets/nfonap-logo.jpg">
    <style>
        /* Additional admin styles */
        body {
            font-family: 'Inter', sans-serif;
            background: #f8f9fa;
            margin: 0;
            padding: 0;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .header {
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
            text-decoration: none;
            color: #333;
        }
        
        .logo-img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
        }
        
        .logo-text {
            font-family: 'Montserrat', sans-serif;
            font-weight: 800;
            font-size: 1.2rem;
            color: #420942;
        }
        
        .logo-tagline {
            font-size: 0.8rem;
            color: #666;
        }
        
        .nav {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .nav-link {
            text-decoration: none;
            color: #333;
            padding: 10px 15px;
            border-radius: 5px;
            transition: background 0.3s;
        }
        
        .nav-link:hover {
            background: #f0f0f0;
        }
        
        .admin-badge {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #420942;
        }
        
        .hero {
            padding-top: 120px;
            min-height: 100vh;
        }
        
        /* Login Section */
        #login-section {
            max-width: 400px;
            margin: 0 auto;
            padding: 3rem;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .text-center {
            text-align: center;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #420942;
            box-shadow: 0 0 0 3px rgba(66, 9, 66, 0.1);
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            text-decoration: none;
        }
        
        .btn-primary {
            background: #420942;
            color: white;
        }
        
        .btn-primary:hover {
            background: #5c2a5c;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(66, 9, 66, 0.2);
        }
        
        .btn-full {
            width: 100%;
        }
        
        .form-text {
            font-size: 0.875rem;
            color: #666;
            margin-top: 10px;
        }
        
        .text-danger {
            color: #dc3545;
        }
        
        /* Dashboard Section */
        #dashboard-section {
            display: none;
        }
        
        .d-flex {
            display: flex;
        }
        
        .justify-between {
            justify-content: space-between;
        }
        
        .align-center {
            align-items: center;
        }
        
        .gap-1 {
            gap: 0.5rem;
        }
        
        .mb-4 {
            margin-bottom: 2rem;
        }
        
        h1 {
            color: #420942;
            margin-bottom: 0.5rem;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            transition: transform 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-icon {
            font-size: 2.5rem;
            color: #420942;
            margin-bottom: 1rem;
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: #420942;
            margin-bottom: 0.5rem;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .card {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        .btn-accent {
            background: #ff6b6b;
            color: white;
        }
        
        .btn-accent:hover {
            background: #ff5252;
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c82333;
        }
        
        .btn-sm {
            padding: 8px 16px;
            font-size: 0.875rem;
        }
        
        #logout-btn {
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 8px 16px;
            cursor: pointer;
            display: none;
        }
        
        /* Toast Container */
        .toast-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1001;
        }
        
        .toast {
            background: #333;
            color: white;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: slideIn 0.3s ease;
        }
        
        .toast.success {
            background: #28a745;
        }
        
        .toast.error {
            background: #dc3545;
        }
        
        .toast.warning {
            background: #ffc107;
            color: #333;
        }
        
        .toast.info {
            background: #17a2b8;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        /* Modal Styles */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-body {
            padding: 1.5rem;
        }
        
        .modal-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }
        
        /* Table Styles */
        #candidates-table {
            overflow-x: auto;
        }
        
        .table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .table th {
            background: #f8f9fa;
            padding: 1rem;
            text-align: left;
            border-bottom: 2px solid #dee2e6;
            font-weight: 600;
            color: #495057;
        }
        
        .table td {
            padding: 1rem;
            border-bottom: 1px solid #dee2e6;
        }
        
        .table tr:hover {
            background: #f8f9fa;
        }
        
        .btn-info {
            background: #17a2b8;
            color: white;
        }
        
        .btn-info:hover {
            background: #138496;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
                align-items: stretch;
            }
            
            .mobile-menu-btn {
                display: block;
            }
            
            .nav {
                display: none;
                flex-direction: column;
                position: absolute;
                top: 100%;
                left: 0;
                right: 0;
                background: white;
                padding: 1rem;
                box-shadow: 0 5px 10px rgba(0,0,0,0.1);
            }
            
            .nav.active {
                display: flex;
            }
            
            .stats-grid {
                grid-template-columns: 1fr 1fr;
            }
            
            #login-section {
                margin: 20px;
                padding: 2rem;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container" style="display: flex; justify-content: space-between; align-items: center; padding: 15px 20px;">
            <a href="index.html" class="logo">
                <img src="assets/nfonap-logo.jpg" alt="NFONAP University" class="logo-img">
                <div>
                    <div class="logo-text">NFONAP UNIVERSITY</div>
                    <div class="logo-tagline">Admin Dashboard</div>
                </div>
            </a>
            
            <nav class="nav">
                <a href="index.html" class="nav-link">
                    <i class="fas fa-home"></i> Home
                </a>
                <a href="miss.html" class="nav-link">
                    <i class="fas fa-female"></i> Miss
                </a>
                <a href="master.html" class="nav-link">
                    <i class="fas fa-male"></i> Master
                </a>
                <a href="admin.html" class="admin-badge">
                    <i class="fas fa-user-shield"></i> Admin
                </a>
                <button id="logout-btn" class="btn btn-danger btn-sm">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </nav>
            
            <button class="mobile-menu-btn" id="mobile-menu-btn">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </header>

    <!-- Admin Dashboard -->
    <section class="hero">
        <div class="container">
            <!-- Login Section -->
            <div id="login-section" class="text-center">
                <h2 style="margin-bottom: 2rem;">Admin Login</h2>
                <div class="form-group">
                    <input type="text" id="admin-username" class="form-control" placeholder="Username">
                </div>
                <div class="form-group">
                    <input type="password" id="admin-password" class="form-control" placeholder="Password">
                </div>
                <button id="login-btn" class="btn btn-primary btn-full">
                    <i class="fas fa-sign-in-alt"></i> Login
                </button>
                <div class="form-text text-center mt-3">
                    <strong>Default:</strong> admin / nfonap2025<br>
                    <small class="text-danger">Change password after first login!</small>
                </div>
            </div>

            <!-- Dashboard Section -->
            <div id="dashboard-section">
                <!-- Dashboard Header -->
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                    <div>
                        <h1 style="margin-bottom: 0.5rem;">Admin Dashboard</h1>
                        <p>Welcome, <span id="admin-name">Admin</span> | Last login: <span id="last-login">Now</span></p>
                    </div>
                    <div style="display: flex; gap: 0.5rem;">
                        <button id="refresh-btn" class="btn btn-secondary">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                        <button id="export-btn" class="btn btn-accent">
                            <i class="fas fa-download"></i> Export
                        </button>
                        <button id="add-candidate-btn" class="btn btn-primary">
                            <i class="fas fa-user-plus"></i> Add Candidate
                        </button>
                    </div>
                </div>

                <!-- Statistics -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-number" id="admin-total-candidates">0</div>
                        <div class="stat-label">Total Candidates</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-vote-yea"></i>
                        </div>
                        <div class="stat-number" id="admin-total-votes">0</div>
                        <div class="stat-label">Total Votes</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-female"></i>
                        </div>
                        <div class="stat-number" id="admin-miss-candidates">0</div>
                        <div class="stat-label">Miss Candidates</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-male"></i>
                        </div>
                        <div class="stat-number" id="admin-master-candidates">0</div>
                        <div class="stat-label">Master Candidates</div>
                    </div>
                </div>

                <!-- Candidates Management -->
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h3 style="margin: 0;">Manage Candidates</h3>
                        <div style="display: flex; gap: 0.5rem;" id="filter-buttons">
                            <button class="btn btn-sm btn-primary" data-filter="all">All</button>
                            <button class="btn btn-sm btn-outline" data-filter="miss">Miss</button>
                            <button class="btn btn-sm btn-outline" data-filter="master">Master</button>
                        </div>
                    </div>
                    
                    <div id="candidates-table">
                        <!-- Candidates will be loaded here -->
                    </div>
                </div>

                <!-- Database Management -->
                <div class="card">
                    <h3 style="margin-bottom: 1.5rem;">Database Management</h3>
                    <div style="display: flex; gap: 0.5rem;">
                        <button id="backup-btn" class="btn btn-secondary">
                            <i class="fas fa-database"></i> Backup Database
                        </button>
                        <button id="restore-btn" class="btn btn-secondary">
                            <i class="fas fa-upload"></i> Restore Database
                        </button>
                        <button id="reset-btn" class="btn btn-danger">
                            <i class="fas fa-trash"></i> Reset Database
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Add Candidate Modal -->
    <div id="add-candidate-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add New Candidate</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="add-candidate-form">
                    <div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
                        <div class="form-group" style="flex: 1;">
                            <label class="form-label">Category *</label>
                            <select id="candidate-category" class="form-control" required>
                                <option value="">Select Category</option>
                                <option value="miss">Miss NFONAP</option>
                                <option value="master">Master NFONAP</option>
                            </select>
                        </div>
                        <div class="form-group" style="flex: 2;">
                            <label class="form-label">Full Name *</label>
                            <input type="text" id="candidate-name" class="form-control" placeholder="John Doe" required>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
                        <div class="form-group" style="flex: 1;">
                            <label class="form-label">Program *</label>
                            <input type="text" id="candidate-program" class="form-control" placeholder="Computer Science" required>
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <label class="form-label">Department *</label>
                            <input type="text" id="candidate-department" class="form-control" placeholder="Faculty of Engineering" required>
                        </div>
                    </div>
                    
                    <div class="form-group" style="margin-bottom: 1rem;">
                        <label class="form-label">Email (Optional)</label>
                        <input type="email" id="candidate-email" class="form-control" placeholder="candidate@nfonap.edu.cm">
                    </div>
                    
                    <div class="form-group" style="margin-bottom: 1rem;">
                        <label class="form-label">Biography *</label>
                        <textarea id="candidate-bio" class="form-control" rows="3" placeholder="Candidate biography..." required></textarea>
                    </div>
                    
                    <div class="form-group" style="margin-bottom: 1rem;">
                        <label class="form-label">Manifesto (Optional)</label>
                        <textarea id="candidate-manifesto" class="form-control" rows="3" placeholder="Candidate manifesto..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button id="cancel-add-btn" class="btn btn-secondary">Cancel</button>
                <button id="submit-add-btn" class="btn btn-primary">Add Candidate</button>
            </div>
        </div>
    </div>

    <!-- Edit Candidate Modal -->
    <div id="edit-candidate-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Candidate</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="edit-candidate-form">
                    <input type="hidden" id="edit-candidate-id">
                    
                    <div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
                        <div class="form-group" style="flex: 1;">
                            <label class="form-label">Category *</label>
                            <select id="edit-candidate-category" class="form-control" required>
                                <option value="miss">Miss NFONAP</option>
                                <option value="master">Master NFONAP</option>
                            </select>
                        </div>
                        <div class="form-group" style="flex: 2;">
                            <label class="form-label">Full Name *</label>
                            <input type="text" id="edit-candidate-name" class="form-control" required>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
                        <div class="form-group" style="flex: 1;">
                            <label class="form-label">Program *</label>
                            <input type="text" id="edit-candidate-program" class="form-control" required>
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <label class="form-label">Department *</label>
                            <input type="text" id="edit-candidate-department" class="form-control" required>
                        </div>
                    </div>
                    
                    <div class="form-group" style="margin-bottom: 1rem;">
                        <label class="form-label">Email</label>
                        <input type="email" id="edit-candidate-email" class="form-control">
                    </div>
                    
                    <div class="form-group" style="margin-bottom: 1rem;">
                        <label class="form-label">Biography *</label>
                        <textarea id="edit-candidate-bio" class="form-control" rows="3" required></textarea>
                    </div>
                    
                    <div class="form-group" style="margin-bottom: 1rem;">
                        <label class="form-label">Manifesto</label>
                        <textarea id="edit-candidate-manifesto" class="form-control" rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button id="cancel-edit-btn" class="btn btn-secondary">Cancel</button>
                <button id="submit-edit-btn" class="btn btn-primary">Update Candidate</button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container" class="toast-container"></div>

    <script>
        // Simple and clean admin script
        let currentFilter = 'all';
        let adminSession = null;

        // Database functions
        const STORAGE_KEYS = {
            CANDIDATES: 'nfonap_candidates',
            VOTES: 'nfonap_votes',
            VOTERS: 'nfonap_voters',
            ADMIN_PASSWORD: 'adminPassword'
        };

        function getCandidates() {
            const data = localStorage.getItem(STORAGE_KEYS.CANDIDATES);
            return data ? JSON.parse(data) : [];
        }

        function saveCandidates(candidates) {
            localStorage.setItem(STORAGE_KEYS.CANDIDATES, JSON.stringify(candidates));
        }

        function getVotes() {
            const data = localStorage.getItem(STORAGE_KEYS.VOTES);
            return data ? JSON.parse(data) : [];
        }

        function getVoters() {
            const data = localStorage.getItem(STORAGE_KEYS.VOTERS);
            return data ? JSON.parse(data) : [];
        }

        // Toast notification
        function showToast(message, type = 'info') {
            const container = document.getElementById('toast-container');
            if (!container) return;
            
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <div>${type === 'success' ? 'âœ“' : type === 'error' ? 'âœ—' : type === 'warning' ? 'âš ' : 'â„¹'}</div>
                <div>${message}</div>
                <button style="background:none; border:none; color:white; cursor:pointer; margin-left:10px;" onclick="this.parentElement.remove()">&times;</button>
            `;
            container.appendChild(toast);
            setTimeout(() => toast.remove(), 5000);
        }

        // Check admin session on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Page loaded, checking admin session...');
            
            // Check for existing session
            const session = sessionStorage.getItem('adminSession');
            if (session) {
                console.log('Found session:', session);
                adminSession = JSON.parse(session);
                showDashboard();
            } else {
                console.log('No session found, showing login form');
                showLoginForm();
            }

            // Initialize default data if empty
            const candidates = getCandidates();
            if (candidates.length === 0) {
                console.log('Initializing default data...');
                initializeDefaultData();
            }

            // Initialize admin password if not set
            if (!localStorage.getItem(STORAGE_KEYS.ADMIN_PASSWORD)) {
                console.log('Setting default admin password...');
                localStorage.setItem(STORAGE_KEYS.ADMIN_PASSWORD, 'nfonap2025');
            }

            // Setup event listeners
            setupEventListeners();
        });

        function initializeDefaultData() {
            const defaultCandidates = [
                {
                    id: 'candidate-1',
                    category: 'miss',
                    name: 'Amara Ndeze',
                    program: 'Computer Science',
                    department: 'Faculty of Engineering',
                    email: 'amara.ndeze@nfonap.edu.cm',
                    bio: 'Passionate about technology and community development.',
                    manifesto: 'Dedicated to improving campus technology.',
                    createdAt: new Date().toISOString()
                },
                {
                    id: 'candidate-2',
                    category: 'miss',
                    name: 'Christelle Tanyi',
                    program: 'Business Administration',
                    department: 'Faculty of Business',
                    email: 'christelle.tanyi@nfonap.edu.cm',
                    bio: 'Entrepreneur and business enthusiast.',
                    manifesto: 'Committed to promoting entrepreneurship.',
                    createdAt: new Date().toISOString()
                },
                {
                    id: 'candidate-3',
                    category: 'master',
                    name: 'David Ngufor',
                    program: 'Software Engineering',
                    department: 'Faculty of Engineering',
                    email: 'david.ngufor@nfonap.edu.cm',
                    bio: 'Tech leader with experience in software development.',
                    manifesto: 'Working towards digital transformation.',
                    createdAt: new Date().toISOString()
                },
                {
                    id: 'candidate-4',
                    category: 'master',
                    name: 'Benjamin Nkwa',
                    program: 'Finance',
                    department: 'Faculty of Business',
                    email: 'benjamin.nkwa@nfonap.edu.cm',
                    bio: 'Economics scholar focused on development.',
                    manifesto: 'Advocating for economic growth.',
                    createdAt: new Date().toISOString()
                }
            ];

            saveCandidates(defaultCandidates);
            console.log('Default data initialized');
        }

        function setupEventListeners() {
            console.log('Setting up event listeners...');
            
            // Login button
            const loginBtn = document.getElementById('login-btn');
            if (loginBtn) {
                loginBtn.addEventListener('click', login);
                console.log('Login button listener added');
            }

            // Enter key in password field
            const passwordInput = document.getElementById('admin-password');
            if (passwordInput) {
                passwordInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        login();
                    }
                });
            }

            // Logout button
            const logoutBtn = document.getElementById('logout-btn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', logout);
            }

            // Refresh button
            const refreshBtn = document.getElementById('refresh-btn');
            if (refreshBtn) {
                refreshBtn.addEventListener('click', refreshDashboard);
            }

            // Export button
            const exportBtn = document.getElementById('export-btn');
            if (exportBtn) {
                exportBtn.addEventListener('click', exportData);
            }

            // Add candidate button
            const addCandidateBtn = document.getElementById('add-candidate-btn');
            if (addCandidateBtn) {
                addCandidateBtn.addEventListener('click', function() {
                    document.getElementById('add-candidate-modal').style.display = 'flex';
                    document.getElementById('add-candidate-form').reset();
                });
            }

            // Cancel add button
            const cancelAddBtn = document.getElementById('cancel-add-btn');
            if (cancelAddBtn) {
                cancelAddBtn.addEventListener('click', function() {
                    document.getElementById('add-candidate-modal').style.display = 'none';
                });
            }

            // Submit add button
            const submitAddBtn = document.getElementById('submit-add-btn');
            if (submitAddBtn) {
                submitAddBtn.addEventListener('click', addCandidate);
            }

            // Cancel edit button
            const cancelEditBtn = document.getElementById('cancel-edit-btn');
            if (cancelEditBtn) {
                cancelEditBtn.addEventListener('click', function() {
                    document.getElementById('edit-candidate-modal').style.display = 'none';
                });
            }

            // Submit edit button
            const submitEditBtn = document.getElementById('submit-edit-btn');
            if (submitEditBtn) {
                submitEditBtn.addEventListener('click', updateCandidate);
            }

            // Filter buttons
            const filterButtons = document.querySelectorAll('#filter-buttons button');
            filterButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    filterCandidates(this.dataset.filter);
                });
            });

            // Modal close buttons
            const modalCloseButtons = document.querySelectorAll('.modal-close');
            modalCloseButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    this.closest('.modal-overlay').style.display = 'none';
                });
            });

            // Click outside modals to close
            const modals = document.querySelectorAll('.modal-overlay');
            modals.forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        this.style.display = 'none';
                    }
                });
            });

            // Mobile menu
            const mobileMenuBtn = document.getElementById('mobile-menu-btn');
            if (mobileMenuBtn) {
                mobileMenuBtn.addEventListener('click', function() {
                    const nav = document.querySelector('.nav');
                    nav.classList.toggle('active');
                });
            }

            // Database buttons
            const backupBtn = document.getElementById('backup-btn');
            if (backupBtn) backupBtn.addEventListener('click', backupDatabase);
            
            const restoreBtn = document.getElementById('restore-btn');
            if (restoreBtn) restoreBtn.addEventListener('click', restoreDatabase);
            
            const resetBtn = document.getElementById('reset-btn');
            if (resetBtn) resetBtn.addEventListener('click', resetDatabase);

            console.log('Event listeners setup complete');
        }

        // Login function
        function login() {
            console.log('Login function called');
            
            const username = document.getElementById('admin-username')?.value.trim();
            const password = document.getElementById('admin-password')?.value.trim();

            console.log('Username:', username);
            console.log('Password entered:', password ? 'Yes' : 'No');

            if (!username || !password) {
                showToast('Please enter username and password', 'warning');
                return;
            }

            const storedPassword = localStorage.getItem(STORAGE_KEYS.ADMIN_PASSWORD) || 'nfonap2025';
            console.log('Stored password:', storedPassword);

            if (username === 'admin' && password === storedPassword) {
                console.log('Credentials correct, logging in...');
                adminSession = {
                    username: username,
                    loginTime: new Date().toISOString()
                };
                sessionStorage.setItem('adminSession', JSON.stringify(adminSession));
                
                showDashboard();
                showToast('Login successful!', 'success');
            } else {
                console.log('Invalid credentials');
                showToast('Invalid username or password', 'error');
            }
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                sessionStorage.removeItem('adminSession');
                adminSession = null;
                showLoginForm();
                showToast('Logged out successfully', 'info');
            }
        }

        function showLoginForm() {
            console.log('Showing login form');
            const loginSection = document.getElementById('login-section');
            const dashboardSection = document.getElementById('dashboard-section');
            const logoutBtn = document.getElementById('logout-btn');
            
            if (loginSection) loginSection.style.display = 'block';
            if (dashboardSection) dashboardSection.style.display = 'none';
            if (logoutBtn) logoutBtn.style.display = 'none';
        }

        function showDashboard() {
            console.log('Showing dashboard');
            const loginSection = document.getElementById('login-section');
            const dashboardSection = document.getElementById('dashboard-section');
            const logoutBtn = document.getElementById('logout-btn');
            
            if (loginSection) loginSection.style.display = 'none';
            if (dashboardSection) dashboardSection.style.display = 'block';
            if (logoutBtn) logoutBtn.style.display = 'inline-block';
            
            if (adminSession) {
                const adminName = document.getElementById('admin-name');
                const lastLogin = document.getElementById('last-login');
                if (adminName) adminName.textContent = adminSession.username;
                if (lastLogin) {
                    const loginTime = new Date(adminSession.loginTime);
                    lastLogin.textContent = loginTime.toLocaleString();
                }
            }
            
            refreshDashboard();
        }

        function refreshDashboard() {
            console.log('Refreshing dashboard...');
            updateStatistics();
            loadCandidatesTable();
        }

        function updateStatistics() {
            console.log('Updating statistics...');
            const candidates = getCandidates();
            const votes = getVotes();
            
            const totalCandidates = candidates.length;
            const missCandidates = candidates.filter(c => c.category === 'miss').length;
            const masterCandidates = candidates.filter(c => c.category === 'master').length;
            const totalVotes = votes.length;

            const totalCandidatesEl = document.getElementById('admin-total-candidates');
            const totalVotesEl = document.getElementById('admin-total-votes');
            const missCandidatesEl = document.getElementById('admin-miss-candidates');
            const masterCandidatesEl = document.getElementById('admin-master-candidates');
            
            if (totalCandidatesEl) totalCandidatesEl.textContent = totalCandidates;
            if (totalVotesEl) totalVotesEl.textContent = totalVotes;
            if (missCandidatesEl) missCandidatesEl.textContent = missCandidates;
            if (masterCandidatesEl) masterCandidatesEl.textContent = masterCandidates;
            
            console.log('Statistics updated');
        }

        function loadCandidatesTable() {
            console.log('Loading candidates table...');
            const container = document.getElementById('candidates-table');
            if (!container) return;
            
            let candidates = getCandidates();
            
            // Apply filter
            if (currentFilter === 'miss') {
                candidates = candidates.filter(c => c.category === 'miss');
            } else if (currentFilter === 'master') {
                candidates = candidates.filter(c => c.category === 'master');
            }
            
            if (candidates.length === 0) {
                container.innerHTML = '<p style="text-align: center; padding: 2rem; color: #666;">No candidates found</p>';
                return;
            }
            
            const votes = getVotes();
            
            let html = '<table class="table">';
            html += '<thead><tr>';
            html += '<th>Name</th>';
            html += '<th>Category</th>';
            html += '<th>Program</th>';
            html += '<th>Votes</th>';
            html += '<th>Actions</th>';
            html += '</tr></thead><tbody>';
            
            candidates.forEach(candidate => {
                const voteCount = votes.filter(v => v.candidateId === candidate.id).length;
                const categoryLabel = candidate.category === 'miss' ? 'ðŸ‘© Miss' : 'ðŸ‘¨ Master';
                
                html += `<tr>
                    <td><strong>${candidate.name}</strong></td>
                    <td>${categoryLabel}</td>
                    <td>${candidate.program}</td>
                    <td><strong>${voteCount}</strong></td>
                    <td>
                        <button class="btn btn-sm btn-info" onclick="editCandidate('${candidate.id}')" style="margin-right: 5px;">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteCandidate('${candidate.id}')">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </td>
                </tr>`;
            });
            
            html += '</tbody></table>';
            container.innerHTML = html;
            
            // Update filter buttons
            updateFilterButtons();
            console.log('Candidates table loaded');
        }

        function updateFilterButtons() {
            const buttons = document.querySelectorAll('#filter-buttons button');
            buttons.forEach(btn => {
                if (btn.dataset.filter === currentFilter) {
                    btn.classList.add('btn-primary');
                    btn.classList.remove('btn-outline');
                } else {
                    btn.classList.remove('btn-primary');
                    btn.classList.add('btn-outline');
                }
            });
        }

        function filterCandidates(filter) {
            currentFilter = filter;
            loadCandidatesTable();
        }

        function addCandidate() {
            const category = document.getElementById('candidate-category').value;
            const name = document.getElementById('candidate-name').value.trim();
            const program = document.getElementById('candidate-program').value.trim();
            const department = document.getElementById('candidate-department').value.trim();
            const email = document.getElementById('candidate-email').value.trim();
            const bio = document.getElementById('candidate-bio').value.trim();
            const manifesto = document.getElementById('candidate-manifesto').value.trim();
            
            if (!category || !name || !program || !department || !bio) {
                showToast('Please fill in all required fields', 'warning');
                return;
            }
            
            const candidates = getCandidates();
            const candidate = {
                id: 'candidate-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9),
                category,
                name,
                program,
                department,
                email,
                bio,
                manifesto,
                createdAt: new Date().toISOString()
            };
            
            candidates.push(candidate);
            saveCandidates(candidates);
            
            document.getElementById('add-candidate-modal').style.display = 'none';
            refreshDashboard();
            showToast('Candidate added successfully!', 'success');
        }

        function editCandidate(candidateId) {
            const candidates = getCandidates();
            const candidate = candidates.find(c => c.id === candidateId);
            
            if (!candidate) {
                showToast('Candidate not found', 'error');
                return;
            }
            
            document.getElementById('edit-candidate-id').value = candidate.id;
            document.getElementById('edit-candidate-category').value = candidate.category;
            document.getElementById('edit-candidate-name').value = candidate.name;
            document.getElementById('edit-candidate-program').value = candidate.program;
            document.getElementById('edit-candidate-department').value = candidate.department;
            document.getElementById('edit-candidate-email').value = candidate.email || '';
            document.getElementById('edit-candidate-bio').value = candidate.bio;
            document.getElementById('edit-candidate-manifesto').value = candidate.manifesto || '';
            
            document.getElementById('edit-candidate-modal').style.display = 'flex';
        }

        function updateCandidate() {
            const candidateId = document.getElementById('edit-candidate-id').value;
            const category = document.getElementById('edit-candidate-category').value;
            const name = document.getElementById('edit-candidate-name').value.trim();
            const program = document.getElementById('edit-candidate-program').value.trim();
            const department = document.getElementById('edit-candidate-department').value.trim();
            const email = document.getElementById('edit-candidate-email').value.trim();
            const bio = document.getElementById('edit-candidate-bio').value.trim();
            const manifesto = document.getElementById('edit-candidate-manifesto').value.trim();
            
            if (!category || !name || !program || !department || !bio) {
                showToast('Please fill in all required fields', 'warning');
                return;
            }
            
            const candidates = getCandidates();
            const candidateIndex = candidates.findIndex(c => c.id === candidateId);
            
            if (candidateIndex === -1) {
                showToast('Candidate not found', 'error');
                return;
            }
            
            candidates[candidateIndex] = {
                ...candidates[candidateIndex],
                category,
                name,
                program,
                department,
                email,
                bio,
                manifesto,
                updatedAt: new Date().toISOString()
            };
            
            saveCandidates(candidates);
            document.getElementById('edit-candidate-modal').style.display = 'none';
            refreshDashboard();
            showToast('Candidate updated successfully!', 'success');
        }

        function deleteCandidate(candidateId) {
            if (!confirm('Are you sure you want to delete this candidate?')) {
                return;
            }
            
            let candidates = getCandidates();
            let votes = getVotes();
            let voters = getVoters();
            
            // Remove candidate
            candidates = candidates.filter(c => c.id !== candidateId);
            
            // Remove votes for this candidate
            votes = votes.filter(v => v.candidateId !== candidateId);
            
            // Remove voters who voted for this candidate
            voters = voters.filter(v => {
                const vote = votes.find(vt => vt.voterEmail === v.email);
                return !vote || vote.candidateId !== candidateId;
            });
            
            saveCandidates(candidates);
            localStorage.setItem(STORAGE_KEYS.VOTES, JSON.stringify(votes));
            localStorage.setItem(STORAGE_KEYS.VOTERS, JSON.stringify(voters));
            
            refreshDashboard();
            showToast('Candidate deleted successfully!', 'success');
        }

        function exportData() {
            const candidates = getCandidates();
            const votes = getVotes();
            
            let csv = 'Name,Category,Program,Department,Email,Votes\n';
            
            candidates.forEach(candidate => {
                const voteCount = votes.filter(v => v.candidateId === candidate.id).length;
                const row = [
                    candidate.name,
                    candidate.category,
                    candidate.program,
                    candidate.department,
                    candidate.email || '',
                    voteCount
                ].map(val => `"${val}"`).join(',');
                csv += row + '\n';
            });
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `nfonap-export-${new Date().toISOString().slice(0, 10)}.csv`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            showToast('Data exported successfully!', 'success');
        }

        function backupDatabase() {
            const backup = {
                timestamp: new Date().toISOString(),
                candidates: getCandidates(),
                votes: getVotes(),
                voters: getVoters()
            };
            
            const blob = new Blob([JSON.stringify(backup, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `nfonap-backup-${new Date().toISOString().slice(0, 10)}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            showToast('Database backed up successfully!', 'success');
        }

        function restoreDatabase() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(event) {
                    try {
                        const backup = JSON.parse(event.target.result);
                        
                        if (!backup.candidates || !backup.votes || !backup.voters) {
                            throw new Error('Invalid backup file');
                        }
                        
                        saveCandidates(backup.candidates);
                        localStorage.setItem(STORAGE_KEYS.VOTES, JSON.stringify(backup.votes));
                        localStorage.setItem(STORAGE_KEYS.VOTERS, JSON.stringify(backup.voters));
                        
                        refreshDashboard();
                        showToast('Database restored successfully!', 'success');
                    } catch (error) {
                        showToast('Error restoring database: ' + error.message, 'error');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        function resetDatabase() {
            if (!confirm('WARNING: This will delete ALL data. Are you sure?')) {
                showToast('Reset cancelled', 'info');
                return;
            }
            
            if (!confirm('Last warning: Type "RESET" to confirm.')) {
                showToast('Reset cancelled', 'info');
                return;
            }
            
            const userInput = prompt('Type "RESET" to confirm:');
            if (userInput !== 'RESET') {
                showToast('Reset cancelled', 'info');
                return;
            }
            
            localStorage.removeItem(STORAGE_KEYS.CANDIDATES);
            localStorage.removeItem(STORAGE_KEYS.VOTES);
            localStorage.removeItem(STORAGE_KEYS.VOTERS);
            
            initializeDefaultData();
            refreshDashboard();
            showToast('Database has been reset!', 'success');
        }

        // Make functions available globally
        window.login = login;
        window.logout = logout;
        window.refreshDashboard = refreshDashboard;
        window.exportData = exportData;
        window.addCandidate = addCandidate;
        window.editCandidate = editCandidate;
        window.updateCandidate = updateCandidate;
        window.deleteCandidate = deleteCandidate;
        window.filterCandidates = filterCandidates;
        window.backupDatabase = backupDatabase;
        window.restoreDatabase = restoreDatabase;
        window.resetDatabase = resetDatabase;
    </script>
</body>
</html>
